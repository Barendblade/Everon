<script src="posts.js"></script>
<script>
    // Dark mode toggle
    const themeToggle = document.getElementById('themeToggle');
    if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark');
    themeToggle.textContent = document.body.classList.contains('dark') ? 'â˜€ï¸' : 'ðŸŒ™';
    themeToggle.addEventListener('click', () => {
        document.body.classList.toggle('dark');
        const isDark = document.body.classList.contains('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        themeToggle.textContent = isDark ? 'â˜€ï¸' : 'ðŸŒ™';
    });

    // Get post ID from URL
    const params = new URLSearchParams(location.search);
    const id = params.get('id');
    const post = POSTS.find(p => p.id === id);

    const titleEl = document.getElementById('postTitle');
    const metaEl = document.getElementById('postMeta');
    const bodyEl = document.getElementById('postBody');
    const commentsList = document.getElementById('commentsList');

    const authorName = "Lumivox"; // Your name
    const postDate = new Date().toLocaleDateString();

    if (post) {
        titleEl.textContent = post.title;
        metaEl.textContent = `By ${authorName} â€¢ ${postDate}`;

        // Render content in correct order
        post.content.forEach(block => {
            if (block.type === 'text') {
                const p = document.createElement('p');
                p.textContent = block.text;
                bodyEl.appendChild(p);
            } else if (block.type === 'image') {
                const img = document.createElement('img');
                img.src = block.src;
                img.alt = block.alt || '';
                img.style.maxWidth = '100%';
                img.style.borderRadius = '12px';
                img.style.margin = '16px 0';
                img.style.cursor = 'pointer';

                // Modal overlay for zoom
                const modal = document.createElement('div');
                modal.className = 'modal';
                const modalImg = document.createElement('img');
                modalImg.src = block.src;
                modal.appendChild(modalImg);
                document.body.appendChild(modal);

                img.addEventListener('click', () => modal.classList.add('active'));
                modal.addEventListener('click', () => modal.classList.remove('active'));

                // Zoom in/out with wheel
                modalImg.addEventListener('wheel', (e) => {
                    e.preventDefault();
                    let scale = Number(modalImg.dataset.scale) || 1;
                    scale += (e.deltaY < 0 ? 0.1 : -0.1);
                    scale = Math.min(Math.max(scale, 1), 5);
                    modalImg.style.transform = `scale(${scale})`;
                    modalImg.dataset.scale = scale;
                });

                bodyEl.appendChild(img);
            }
        });
    } else {
        bodyEl.textContent = 'Post not found.';
    }

    // Comment system (session storage only)
    const commentForm = document.getElementById('commentForm');
    const commentInput = document.getElementById('commentInput');

    let comments = JSON.parse(sessionStorage.getItem('comments_' + id) || '[]');
    comments.forEach(c => addCommentToDOM(c));

    commentForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const text = commentInput.value.trim();
        if (!text) return;
        const comment = { author: authorName, text };
        comments.push(comment);
        sessionStorage.setItem('comments_' + id, JSON.stringify(comments));
        addCommentToDOM(comment);
        commentInput.value = '';
    });

    function addCommentToDOM(comment) {
        const div = document.createElement('div');
        div.className = 'comment';
        div.innerHTML = `
            <div class="comment-author">${comment.author}</div>
            <div class="comment-text">${comment.text}</div>
        `;
        commentsList.appendChild(div);
    }
</script>
